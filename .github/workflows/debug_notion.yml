name: Notion Column Debug

on:
  workflow_dispatch:

jobs:
  test-columns:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          pip install notion-client

      - name: Run column test
        env:
          NOTION_TOKEN: ${{ secrets.NOTION_TOKEN }}
          TEST_PAGE_ID: ${{ secrets.TEST_PAGE_ID }}
        run: |
          cat << 'EOF' > test_columns.py
from notion_client import Client

notion = Client(auth="${NOTION_TOKEN}")
page_id = "${TEST_PAGE_ID}"

print("\nüîç Fetching level 1 blocks...")
level1 = notion.blocks.children.list(page_id)
print("LEVEL 1 TYPES:", [b["type"] for b in level1["results"]])

col_list_id = None
for b in level1["results"]:
    if b["type"] == "column_list":
        col_list_id = b["id"]
        break

print("\ncolumn_list id:", col_list_id)

if not col_list_id:
    print("‚ùå No column_list found on this page")
    exit()

print("\nüîç Fetching columns inside column_list...")
cols = notion.blocks.children.list(col_list_id)
print("COLUMNS:", [c["id"] for c in cols["results"]])

for col in cols["res]()
