name: Notion Column Debug

on:
  workflow_dispatch:

jobs:
  test-columns:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          pip install notion-client

      - name: Run column test
        env:
          NOTION_TOKEN: ${{ secrets.NOTION_TOKEN }}
          TEST_PAGE_ID: ${{ secrets.TEST_PAGE_ID }}
        run: |
          printf "%s\n" \
"from notion_client import Client

notion = Client(auth='${NOTION_TOKEN}')
page_id = '${TEST_PAGE_ID}'

print('\\nðŸ” Fetching level 1 blocks...')
level1 = notion.blocks.children.list(page_id)
print('LEVEL 1 TYPES:', [b['type'] for b in level1['results']])

col_list_id = None
for b in level1['results']:
    if b['type'] == 'column_list':
        col_list_id = b['id']
        break

print('\\ncolumn_list id:', col_list_id)

if not col_list_id:
    print('âŒ No column_list found on this page')
    exit()

print('\\nðŸ” Fetching columns inside column_list...')
cols = notion.blocks.children.list(col_list_id)
print('COLUMNS:', [c['id'] for c in cols['results']])

for col in cols['results']:
    cid = col['id']
    print(f'\\nðŸ” Fetching children of column {cid} â€¦')
    children = notion.blocks.children.list(cid)
    print('CHILD TYPES:', [ch['type'] for ch in children['results']])
    for ch in children['results']:
        data = ch.get(ch['type'], {})
        rt = data.get('rich_text')
        if rt:
            print(' â€¢', ch['type'], 'â†’', [t.get('plain_text','') for t in rt])
        else:
            print(' â€¢', ch['type'], '(no rich_text)')
" > test_columns.py

          python test_columns.py
